var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};$.arcticmodal("setDefault",{modal:!1,closeOnEsc:!1,openEffect:{type:"none"},closeEffect:{type:"none"},closeOnOverlayClick:!0}),$.fn.reverse=[].reverse,$.fn.serializeObject=function(){var e={};return $.map($(this).serializeArray(),function(t,n){e[t.name]=t.value}),e},$(function(){Creonit.Admin.Component.Utils.initializeComponents()});var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){this.scopes=[],this.parameters={}}return e.prototype.applySchema=function(t){var n=this;t=$.extend({},t),t.template&&(this.template=twig({autoescape:!0,data:t.template}),delete t.template),t.scopes&&(this.scopes=[],t.scopes.forEach(function(t){var o=new e;o.applySchema(t),n.addScope(o)}),delete t.scopes),$.extend(this.parameters,t)},e.prototype.getScope=function(e){return this.scopes.filter(function(t){return t.parameters.name==e})[0]},e.prototype.addScope=function(e){return e.setParentScope(this),this.scopes.push(e),this},e.prototype.setParentScope=function(e){return this.parentScope=e,this},e}();e.Scope=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(Creonit){var Admin;!function(Admin){var Component;!function(Component_1){var Component=function(_super){function Component(e,t,n,o,i){void 0===n&&(n={}),void 0===o&&(o={}),_super.call(this),this.query={},this.options={},this.data={},this.actions={},this.events={},this.manager=Admin.Manager.getInstance(),t.indexOf(".")==-1?t=i?i.getModuleName()+"."+t:CreonitAdminActiveModule+"."+t:0==t.indexOf(".")&&(t=CreonitAdminActiveModule+t),this.name=t,this.query=$.extend({},n),this.node=e,this.parent=i,this.options=o,this.initialize(),this.loadSchema()}return __extends(Component,_super),Component.prototype.initialize=function(){},Component.prototype.getNode=function(){return this.node},Component.prototype.action=function(e,t){if(this.actions[e])return this.actions[e].apply(this,t);throw new Error("Undefined method "+e+" in component "+this.name)},Component.prototype.getName=function(){return this.name},Component.prototype.getModuleName=function(){return this.name.substring(0,this.name.indexOf("."))},Component.prototype.getQuery=function(){return $.extend({},this.query)},Component.prototype.loadSchema=function(){var e=this;this.node.html('<div class="loading"><i class="fa fa-cog fa-spin fa-fw"></i></div>'),this.request(Component_1.Request.TYPE_LOAD_SCHEMA,this.getQuery(),null,function(t){e.checkResponse(t,e.options.modal)?e.applyResponse(t):e.options.modal?e.close():e.node.html('<div class="loading is-error"><i class="fa fa-cog fa-spin fa-fw"></i>'+(t.error._?t.error._.join(", "):"Ошибка загрузки компонента")+"</div>")})},Component.prototype.loadData=function(){var e=this;this.parameters.reloadSchema?this.loadSchema():(this.node.stop(!0).delay(300).animate({opacity:.85},600),this.request(Component_1.Request.TYPE_LOAD_DATA,this.getQuery(),null,function(t){e.node.stop(!0).animate({opacity:1},300),e.checkResponse(t)&&e.applyResponse(t)}))},Component.prototype.checkResponse=function(e,t){return void 0===t&&(t=!0),!e.error||(t&&e.error._&&alert(e.error._.join("\n")),!1)},Component.prototype.applyResponse=function(e){e.schema&&this.applySchema(e.schema),e.query&&$.extend(this.query,e.query),this.data=e.data||{},this.render(),this.node.find("[js-component-external-field-reset]").off(".component").on("click.component",function(e){e.preventDefault();var t=$(e.currentTarget).prev("a").find("[js-component-external-field]");t.text(t.data("empty")).parent().parent().next("input").val("")})},Component.prototype.applySchema=function(schema){var _this=this;$.each(schema.actions,function(name,action){_this.actions[name]=eval("(function(){return "+action+"})()")}),$.each(schema.events,function(name,action){_this.on(name,eval("(function(){return "+action+"})()"))}),$.extend(this.actions,{openComponent:this.openComponent}),this.options.external&&(this.actions.external=function(e,t){_this.parent.node.find("[js-component-external-field="+_this.options.external+"]").text(t).parent().parent().next("input").val(e),_this.close()}),_super.prototype.applySchema.call(this,schema)},Component.prototype.render=function(){},Component.prototype.close=function(){this.options.modal&&this.node.arcticmodal("close")},Component.prototype.trigger=function(e,t){var n=this;this.events[e]&&this.events[e].forEach(function(e){e.call(n,t)}),this.manager.trigger("component_"+e,$.extend({},t,{component:this}))},Component.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].indexOf(t)==-1&&this.events[e].push(t)},Component.prototype.request=function(e,t,n,o){void 0===t&&(t={}),this.manager.request(new Component_1.Request(this,e,t,n,o))},Component.prototype.openComponent=function(e,t,n){var o=this;void 0===t&&(t={}),void 0===n&&(n={}),n.modal=!0;var i,a=$('\n                <div class="modal-dialog modal-lg">\n                    '+Component_1.Helpers.component(e,t,n)+"\n                </div>\n            ");a.arcticmodal({beforeOpen:function(e,t){Component_1.Utils.initializeComponents(t,o)},afterOpen:function(e,t){var n=t.closest(".arcticmodal-container");i=setInterval(function(){var e=t.find(".modal-footer");if(e.length){clearInterval(i);var o=function(){e.offset({top:n.height()+$(window).scrollTop()-e.outerHeight()}),parseInt(e.css("top"))>0&&e.removeAttr("style")};i=setInterval(o,1e3),o(),n.on("scroll",o)}},10)},beforeClose:function(){a.find("[js-component]").data("creonit-component").trigger("close",{})},afterClose:function(){clearInterval(i)}})},Component}(Component_1.Scope);Component_1.Component=Component}(Component=Admin.Component||(Admin.Component={}))}(Admin=Creonit.Admin||(Creonit.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(t){function n(){t.apply(this,arguments),this.locked=!1}return __extends(n,t),n.prototype.initialize=function(){this.node.addClass("component component-editor")},n.prototype.render=function(){var t=this;this.node.empty();var o=this.node;this.options.modal&&(this.node.append(o=$('\n                    <div class="modal-content"> \n                        <div class="modal-header"> \n                            <button type="button" class="close"><span>×</span></button> \n                            <h4 class="modal-title">'+this.parameters.title+'</h4> \n                        </div> \n                        \n                        <div class="modal-body">\n                        </div>\n                   </div>    \n                ')),o=o.find(".modal-body"),this.node.find(".modal-content").append('<div class="modal-footer">'+e.Helpers.submit("Сохранить и закрыть",{className:"editor-save-and-close"})+" "+e.Helpers.submit("Сохранить")+" "+e.Helpers.button("Закрыть")+"</div>"),this.node.find(".modal-footer button[type=button], .modal-header .close").on("click",function(){t.close()})),o.append(this.template.render($.extend({},this.data,{_query:this.query,_key:this.query.key||null}))),this.options.modal||this.node.append(e.Helpers.submit("Сохранить"));var i="form"+ ++n.increment,a=$('<form id="'+i+'"></form>');this.node.append(a),this.node.find("input, textarea, select, button").attr("form",i).filter("input").eq(0).focus(),this.node.find("select[js-component-select-reload]").change(function(){var e=a.serializeObject(),n=t.getQuery();t.request("reload_data",n,e,function(e){t.checkResponse(e)&&t.applyResponse(e)})}),this.node.find(".text-editor").tinymce({doctype:"html5",element_format:"html",plugins:["anchor autolink code colorpicker contextmenu image fullscreen hr link lists media paste nonbreaking  visualblocks table searchreplace charmap"],resize:!0,height:150,visualblocks_default_state:!0,relative_urls:!1,paste_data_images:!0,paste_as_text:!0,keep_styles:!1,language:"ru",statusbar:!1,toolbar:"formatselect | bold italic removeformat | link unlink | bullist numlist | image media | code fullscreen",image_advtab:!0,menubar:"edit insert view format table tools",browser_spellcheck:!0,setup:function(e){}}),this.node.find("input").filter("[data-inputmask]").inputmask(),this.node.find(".editor-save-and-close").on("click",function(e){$(e.currentTarget).attr("clicked",!0)}),this.node.find("[js-component-action]").on("click",function(e){e.preventDefault();var n=$(e.currentTarget);t.action(n.data("name"),n.data("options"))}),a.on("submit",function(e){if(e.preventDefault(),!t.locked){t.locked=!0;var n=a.serializeObject(),o=t.getQuery(),r=t.node.find(".editor-save-and-close[clicked]"),s=!!r.length;r.removeAttr("clicked"),s&&(o.closeAfterSave=1),t.node.find('input[type="file"][form="'+i+'"]').each(function(){var e=$(this)[0].files[0];e&&(n[$(this).attr("name")]=$(this)[0].files[0])}),t.node.find(".error-message").each(function(){var e=$(this),t=e.closest(".form-group");e.remove(),t.removeClass("has-error")}),t.request("send_data",o,n,function(e){t.locked=!1,t.checkResponse(e)?(s?t.close():t.applyResponse(e),t.trigger("save",{response:e})):$.each(e.error,function(e,n){"_"!=e&&t.node.find("input[name="+e+"], select[name="+e+"], textarea[name="+e+"]").each(function(){var e=$(this),t=e.closest(".form-group");t.addClass("has-error"),e.after('<span class="help-block error-message">'+n.join("<br>")+"</span>")})})}),t.parent&&t.parent.loadData()}}),this.trigger("render",{}),e.Utils.initializeComponents(this.node,this)},n.increment=0,n}(e.Component);e.Editor=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function n(e){var t;return t=$.isArray(e)?[]:{},$.each(e,function(e,o){"_keys"!=e&&($.isPlainObject(o)?t[e]=n(o):t[e]=o)}),t}function o(e){return e.match(/^(fa-|glyphicon-)/)||(e="fa-"+e),e.split("-",1)[0]+" "+e}function i(e,t){var n=void 0===t?{}:t,i=n.size,a=void 0===i?"":i,r=n.type,s=void 0===r?"default":r,c=n.icon,l=void 0===c?"":c,p=n.className,d=void 0===p?"":p,u=n.disabled,m=void 0!==u&&u;return'<button \n                class="btn btn-'+s+" "+(a?"btn-"+a:"")+" "+d+'" \n                type="button" \n                '+(m?"disabled":"")+"\n            >\n                "+(l?'<i class="'+(""!==e?"icon":"")+" "+o(l)+'"></i>':"")+(e+"\n            </button>")}function a(e,t){var n=void 0===t?{}:t,i=n.size,a=void 0===i?"":i,r=n.type,s=void 0===r?"primary":r,c=n.icon,l=void 0===c?"":c,p=n.className,d=void 0===p?"":p;return'\n            <button \n                class="btn btn-'+s+" "+(a?"btn-"+a:"")+" "+d+'" \n                type="submit" \n            >\n                '+(l?'<i class="'+o(l)+'"></i>'+(e?" ":""):"")+(e+"\n            </button>\n        ")}function r(e,t,o){return t=JSON.stringify(n(t)),o=JSON.stringify(n(o)),"<div js-component='"+e+" "+t+" "+o+"'></div>"}function s(e,t){return this.context._controls?this.context._controls(e,t):e}function c(e,t){var n=t[0],o=t[1],i=void 0===o?"top":o;if(!n)return e;var a='data-toggle="tooltip" data-placement="'+i+'" title="'+n+'"';return e.toString().replace(/<(a|div|button)/,"<$1 "+a)}function l(e,t){var n=void 0===t?["",{}]:t,i=n[0],a=void 0===i?"":i,r=n[1],s=void 0===r?{}:r;return a?s.nobr?'<nobr><i class="icon '+o(a)+'"></i>'+e+"</nobr>":'<i class="icon '+o(a)+'"></i>'+e:e}function p(t,o){var i=o[0],a=o.slice(1);if(!t&&0!==t)return"";var r='js-component-action data-name="'+i+"\" data-options='"+JSON.stringify(n(a))+"'";return"object"==typeof t&&t.twig_markup||(t=e.Utils.escape(t)),t.toString().match(/<(a|button)/)?t.toString().replace(/<(a|button)/,"<$1 "+r):'<a href="#" '+r+">"+t+"</a>"}function d(e,t){var n=t[0],o=t[1],i=void 0===o?{}:o,a=t[2],r=void 0===a?{}:a;return p(e,["openComponent",n,i,r])}function u(e,t){var n=t[0],o=(t[1],"Файл не загружен");return e&&(o='\n                <a href="'+e.path+"/"+e.name+'" target="_blank">'+e.original_name+"</a> ("+e.size+')\n                <div class="checkbox">\n                    <label class="small">\n                        <input type="checkbox" name="'+n+'__delete"> Удалить файл\n                    </label>\n                </div>\n            '),'\n            <div class="panel panel-default">\n                <div class="panel-heading"><input type="file" name="'+n+'"></div>\n                <div class="panel-body">'+o+"</div>\n            </div>\n        "}function m(e,t){var n=void 0===t?["",{}]:t,o=n[0],i=(n[1],"Видео не загружено"),a="";return e&&(a=e.url,i='<a href="'+e.url+'" target="_blank">'+e.preview+"</a>"),'\n            <div class="panel panel-default">\n                <div class="panel-heading"><input type="text" class="form-control" name="'+o+'" value="'+a+'" placeholder="Ссылка на YouTube"></div>\n                <div class="panel-body">'+i+"</div>\n            </div>\n        "}function f(t,n){var o=void 0===n?["","",{}]:n,i=o[0],a=o[1],r=o[2],s=void 0===r?{}:r,c=e.Utils.generateId(),l=s.empty||"Значение не выбрано";return t||(t={title:l,value:""}),'\n            <div class="input-group">\n                <div class="input-group-addon"><i class="fa fa-arrow-right"></i></div>\n                '+d(e.Utils.raw('\n                        <div class="form-control" js-component-external-field="'+c+'" data-empty="'+l+'">'+t.title+"</div>\n                    "),[a,$.extend(s.query||{},{value:t.value}),{external:c}])+'\n                <div class="input-group-addon" js-component-external-field-reset><i class="fa fa-remove"></i></div>\n            </div>\n           \n            <input type="hidden" name="'+i+'" value="'+t.value+'">\n        '}function v(e,t){var n=void 0===t?["",{}]:t,o=n[0],i=n[1],a=void 0===i?{}:i;a=$.extend({deletable:!0},a);var r="Изображение не загружено";return e&&(r='<a href="'+e.path+"/"+e.name+'" target="_blank">'+e.preview+"</a>",a.deletable&&(r+='   \n                    <div class="checkbox">\n                        <label class="small">\n                            <input type="checkbox" name="'+o+'__delete"> Удалить изображение\n                        </label>\n                    </div>\n                ')),'\n            <div class="panel panel-default">\n                <div class="panel-heading"><input type="file" name="'+o+'"></div>\n                <div class="panel-body">'+r+"</div>\n            </div>\n        "}function h(e,t){var n=t&&t[0]?t[0]:"";return r("Media.GalleryTable",{field_name:n,gallery_id:e},{})+('<input type="hidden" name="'+n+'" value="'+e+'">')}function y(e,t){var n=void 0===t?["",{}]:t,o=n[0],i=void 0===o?"":o,a=n[1],r=void 0===a?{}:a;e||(e={options:[],value:""});var s=e.options.map(function(t){return'<option value="'+t.value+'" '+(e.value==t.value?"selected":"")+">"+t.title+"</option>"});return r.empty&&s.unshift('<option value="">'+r.empty+"</option>"),'<select name="'+i+'" class="form-control" '+(r.reload?"js-component-select-reload":"")+">"+s.join("")+"</select>"}function g(e){return e}function b(t,n){var o=void 0===n?[]:n,i=o[0],a=void 0===i?"":i,r=o[1],s=void 0===r?"":r;return t=t?e.Utils.escape(t.toString()):"",'<div class="checkbox"><label><input type="checkbox" name="'+a+'" '+(t?"checked":"")+"> "+s+"</label></div>"}function C(t,n){var o=n[0],i=n[1],a=n[2];a=a||{};var r=[],s=["form-control"];switch(a.size&&s.push("input-"+a.size),i){case"date":i="text",r.push('data-inputmask=\'"alias": "dd/mm/yyyy", "mask": "1.2.y", "separator": ".", "placeholder": "дд.мм.гггг"\'');break;case"datetime":i="text",r.push('data-inputmask=\'"alias": "datetime", "mask": "1.2.y h:s:s", "separator": ".", "placeholder": "дд.мм.гггг чч:мм:сс"\'')}return t=t?e.Utils.escape(t.toString()):"",a.placeholder&&(a.placeholder=e.Utils.escape(a.placeholder)),'<input type="'+i+'" class="'+s.join(" ")+'" name="'+o+'" value="'+t+'" placeholder="'+(a.placeholder||"")+'" '+r.join(" ")+">"}function _(e,t){var n=t[0],o=t[1];return C(e,[n,"text",o])}function k(t,n){var o=n&&n[0]?n[0]:"",n=n&&n[1]?n[1]:{};return t=t?e.Utils.escape(t.toString()):"",'<textarea class="form-control" name="'+o+'">'+t+"</textarea>"}function x(t,n){var o=void 0===n?["",{}]:n,i=o[0],a=void 0===i?"":i;o[1];return t=t?e.Utils.escape(t.toString()):"",'<textarea class="text-editor" name="'+a+'">'+t+"</textarea>"}function w(e,t){var n=void 0===t?["",{}]:t,o=n[0],i=void 0===o?"":o,a=n[1],r=void 0===a?{}:a,s="widget_"+ ++R;return e=e.replace(/<(input|textarea|select)/i,'<$1 id="'+s+'"'),i?'\n            <div class="form-group">\n                <label for="'+s+'" class="control-label">'+i+(r.notice?'<span class="control-label-notice">'+r.notice+"</span>":"")+"</label>\n                "+e+"\n            </div>\n        ":'\n            <div class="form-group">\n                '+e+"\n            </div>\n        "}function A(e,t){var n=void 0===t?[]:t,o=n[0],i=void 0===o?"default":o,a=n[1],r=void 0===a?"":a;return'<div class="panel panel-'+i+'">'+(r?'<div class="panel-heading">'+r+"</div>":"")+'<div class="panel-body">'+e+"</div></div>"}function S(e,t){var n=(void 0===t?[]:t)[0],o=void 0===n?6:n;return'<div class="col-md-'+o+'">'+e+"</div>"}function q(e){return'<div class="row">'+e+"</div>"}function D(e){return'<div class="btn-group">'+e+"</div>"}function T(e,t){Twig.extendFunction(e,function(){for(var n=[],o=0;o<arguments.length;o++)n[o-0]=arguments[o];var i=new String(t.apply(this,n));return i.twig_markup=!0,i.twig_filter=e,i})}function j(e,t){Twig.extendFilter(e,function(){for(var n=[],o=0;o<arguments.length;o++)n[o-0]=arguments[o];var i=new String(t.apply(this,n));return i.twig_markup=!0,i.twig_filter=e,i})}function U(){["controls","checkbox","radio","text","input","content","textarea","textedit","file","video","image","external","gallery","select","buttons","group","tooltip","icon","action","open","panel","row","col"].forEach(function(e){j(e,t[e])})}function O(){["button","submit","buttons","component","panel","group","row"].forEach(function(e){T(e,t[e])})}var R=0;t.button=i,t.submit=a,t.component=r,t.controls=s,t.tooltip=c,t.icon=l,t.action=p,t.open=d,t.file=u,t.video=m,t.external=f,t.image=v,t.gallery=h,t.select=y,t.radio=g,t.checkbox=b,t.input=C,t.text=_,t.textarea=k,t.textedit=x,t.group=w,t.panel=A,t.col=S,t.row=q,t.buttons=D,t.registerTwigFunction=T,t.registerTwigFilter=j,U(),O()}(t=e.Helpers||(e.Helpers={}))}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.render=function(){this.node.html(this.template.render($.extend({},this.data,{parameters:this.query}))),e.Utils.initializeComponents(this.node,this)},n}(e.Component);e.List=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t=function(){function t(){this.requestStack=[],this.events={}}return t.getInstance=function(){return this.instance||(this.instance=new this,this.instance.timer()),this.instance},t.prototype.trigger=function(e,t){var n=this;this.events[e]&&this.events[e].forEach(function(e){e.call(n,t)})},t.prototype.on=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].indexOf(t)==-1&&this.events[e].push(t)},t.prototype.request=function(e){this.requestStack.push(e),this.requestStack.length>100&&this.requestSend()},t.prototype.requestSend=function(){function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function n(e){var t=e.map(function(e){return"["+e+"]"});return t[0]=e[0],t.join("")}var o=this.requestStack.splice(0,this.requestStack.length),i=new FormData;o.forEach(function(e){function o(e,n){$.each(e,function(e,i){var s=n.slice();s.push(e);var c=t(i);switch(c){case"Array":break;case"Object":break;case"FileList":break;case"File":a(s,i);break;case"Blob":a(s,i,i.name);break;default:a(s,i)}r(i)&&o(i,s)})}var a=function(e,t,o){var a=n(e);"undefined"==typeof o?i.append(a,t):i.append(a,t,o)},r=function(e){var n=t(e);switch(n){case"Array":return!0;case"Object":return!0;case"FileList":return!0;default:return!1}};o(e.getQuery(),["request[c"+e.getId()+"]"])}),$.ajax({url:baseUrl+"/admin/",type:"post",dataType:"json",data:i,processData:!1,contentType:!1,success:function(t){o.forEach(function(n,o){n.passResponse(new e.Component.Response(t[o]))})},complete:function(e){401!=e.status&&403!=e.status||document.location.reload()},error:function(){}})},t.prototype.timer=function(){var e=this;this.timerInstance=setTimeout(function(){e.requestStack.length&&e.requestSend(),e.timer()},10)},t}();e.Manager=t}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(t,n,o,i,a){this.id=e.increment++,this.component=t,this.name=t.getName(),this.type=n,this.query=o,this.data=i,this.callback=a?a.bind(t):null}return e.prototype.getId=function(){return this.id},e.prototype.getQuery=function(){return{name:this.name,type:this.type,query:this.query,data:this.data}},e.prototype.passResponse=function(e){console.log(e),this.callback&&this.callback(e)},e.TYPE_LOAD_SCHEMA="load_schema",e.TYPE_LOAD_DATA="load_data",e.increment=1,e}();e.Request=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){$.extend(this,e)}return e}();e.Response=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(e){var t;!function(e){var t;!function(e){var t=function(t){function n(){t.apply(this,arguments),this.expanded={},this.pagination={}}return __extends(n,t),n.prototype.initialize=function(){this.node.addClass("component component-table")},n.prototype.getQuery=function(){return $.extend(t.prototype.getQuery.call(this),{expanded:this.expanded,pagination:this.pagination})},n.prototype.applySchema=function(e){var n=this;t.prototype.applySchema.call(this,e),this.actions._visible=function(e){var t=n.findRowById(e.row_id),o=t.find(".table-row-visible"),i=!o.hasClass("mod-visible");o.toggleClass("mod-visible",i),n.request("_visible",$.extend(n.getQuery(),{key:e.key,scope:e.scope}),{visible:i},function(t){n.checkResponse(t)&&(o.toggleClass("mod-visible",t.data.visible),n.trigger("visible",{options:e,visible:i}))})},this.actions._delete=function(e){confirm("Элемент будет удален, продолжить?")&&(n.request("_delete",$.extend(n.getQuery(),e),null,function(t){n.checkResponse(t)&&n.trigger("delete",{options:e})}),n.loadData())}},n.prototype.findRowById=function(e){var t=this.node.find("tr[data-row-id="+e+"]:eq(0)");return t.length?t:null},n.prototype.render=function(){var t=this;this.node.empty();var n=this.node;this.options.modal&&(this.node.append(n=$('\n                    <div class="modal-content"> \n                        <div class="modal-header"> \n                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button> \n                            <h4 class="modal-title">'+this.parameters.title+'</h4> \n                        </div> \n                        \n                        <div class="modal-body mod-table"></div>\n                   </div>    \n                ')),n=n.find(".modal-body"),this.node.find(".modal-header .close").on("click",function(){t.close()})),n.html(this.template.render($.extend({},this.data,{_query:this.query}))),this.scopes.forEach(function(e){e.parameters.independent&&(e.parameters.recursive?$.each(t.parameters.relations,function(n,o){if(o.source.scope==e.parameters.name)return t.renderScope(e,o),!1}):t.renderScope(e))}),this.node.find("[js-component-action]").on("click",function(e){e.preventDefault();var n=$(e.currentTarget);t.action(n.data("name"),n.data("options"))}),this.node.find("tbody").children().length||this.node.find(".table:eq(0)").replaceWith('<div class="component-table-empty">Список пуст</div>'),this.node.find('[data-toggle="tooltip"]').tooltip({container:"body",trigger:"hover"});var o,i=this.node.find("table");i.find(".list-controls-flex.has-children").on("click",function(e){var n,o=$(e.currentTarget).closest("tr"),i=o.data("mask"),a=o.data("key");t.expanded[i]||(t.expanded[i]=[]),(n=t.expanded[i].indexOf(a))>=0?t.expanded[i].splice(n,1):t.expanded[i].push(a),t.loadData()}),i.find(".list-pagination li:not(.active) span").on("click",function(e){var n=$(e.currentTarget),o=n.closest("tr");t.pagination[o.data("mask")]=n.data("page"),t.loadData()}),i.tableDnD({onDragClass:"move",onDrop:function(e,n){if(o!==$.tableDnD.serialize()){var a=$(n).closest("tr"),r=a.data("mask"),s='tr[data-mask="'+r+'"]:first',c=$(n).prevAll(s),l=$(n).nextAll(s);i.addClass("sorting-send"),t.request("_sort",$.extend(t.getQuery(),{key:a.data("key"),scope:a.data("scope")}),{prev:c.length?c.data("key"):0,next:l.length?l.data("key"):0},function(e){return t.checkResponse(e)}),t.loadData()}else $("> tbody > tr",t.node.find("table")).removeClass("nodrop"),i.removeClass("sorting")},onDragStart:function(e,n){var a=$(n).closest("tr"),r=a.data("mask");o=$.tableDnD.serialize(),i.addClass("sorting"),a.addClass("sorting"),$("> thead > tr",t.node.find("table")).addClass("nodrop"),$('> tbody > tr:not([data-mask="'+r+'"])',t.node.find("table")).addClass("nodrop")},dragHandle:".list-controls-sort",serializeRegexp:!1}),this.node.find(".panel-heading form").on("submit",function(e){e.preventDefault();var n=$(e.currentTarget);$.extend(t.query,n.serializeObject()),t.loadData()}),this.node.find("input").filter("[data-inputmask]").inputmask(),this.trigger("render",{}),e.Utils.initializeComponents(this.node,this)},n.prototype.renderScope=function(t,n,o,i){var a=this;void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=0);var r=t.parameters.name+"."+(n?n.target.scope+"."+(o||""):"_");if(this.data.entities[r]&&(this.data.entities[r].forEach(function(n){var o=e.Utils.generateId(),s=n._row_class,c=$('<tr data-row-id="'+o+'" data-key="'+JSON.stringify(n._key)+'" data-scope="'+t.parameters.name+'" data-mask="'+r+'" '+(s?'class="'+s+'"':"")+">"+t.template.render($.extend({},n,{_data:a.data,_query:a.getQuery(),_row_id:o,_level:function(){return e.Utils.raw(new Array(i+1).join("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"))},_visible:function(){return e.Utils.raw(e.Helpers.action(e.Utils.raw(e.Helpers.button("",{size:"xs",icon:"eye",className:"table-row-visible "+(n.visible?"mod-visible":"")})),["_visible",{scope:t.parameters.name,key:n._key,row_id:o}]))},_delete:function(){return e.Utils.raw(e.Helpers.action(e.Utils.raw(e.Helpers.button("",{size:"xs",icon:"remove"})),["_delete",{scope:t.parameters.name,key:n._key,row_id:o}]))},_controls:function(e,o){var s=(void 0===o?[""]:o)[0],c=void 0===s?"":s;return'\n                                <div class="list-controls">\n                                    <div class="list-controls-level">'+new Array(i+1).join("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+"</div>\n                                    "+(t.parameters.collapsed?'<div class="list-controls-flex '+(n._has_children?"has-children":"")+'">'+(n._has_children?a.expanded[r]&&a.expanded[r].indexOf(n._key)>=0?'<i class="fa fa-minus-square-o"></i>':'<i class="fa fa-plus-square-o"></i>':'<i class="fa fa-square-o"></i>')+"</div>":"")+'\n                                    <div class="list-controls-value">'+e+"</div>\n                                    "+(t.parameters.sortable?'<div class="list-controls-sort"><i class="fa fa-arrows-v"></i></div>':"")+"\n                                    "+(c?'<div class="list-controls-options">'+c+"</div>":"")+"\n                                </div>\n                            "}}))+"</tr>");a.node.find("tbody").append(c),$.each(a.parameters.relations,function(e,o){o.target.scope==t.parameters.name&&a.renderScope(a.getScope(o.source.scope),o,n[o.target.field],i+1)})}),this.data.pagination&&this.data.pagination[r])){var s=this.data.pagination[r];if(s.last_page>1){for(var c="",l=1;l<=s.last_page;l++)c+="<li "+(l==s.page?'class="active"':"")+'><span data-page="'+l+'">'+l+"</span></li>";this.node.find("tbody").append($('<tr class="list-pagination" data-mask="'+r+'"><td colspan="15">'+new Array(i+1).join("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")+'<ul class="pagination pagination-info">'+c+"</ul></td></tr>"))}}},n}(e.Component);e.Table=t}(t=e.Component||(e.Component={}))}(t=e.Admin||(e.Admin={}))}(Creonit||(Creonit={}));var Creonit;!function(Creonit){var Admin;!function(Admin){var Component;!function(Component){var Utils;!function(Utils){function escape(e){return e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function createComponent(node,parent){var componentData=node.attr(Utils.ATTR_HANDLER).match(/^((?:\w*\.)?\w+([A-Z][a-z\d]+))\s*(\{\s*.*?\s*\})?(?:\s(\{\s*.*\s*\}))?\s*$/);if(null===componentData)throw'Wrong component name format "'+node.attr(Utils.ATTR_HANDLER)+'"';var componentName=componentData[1],componentType=componentData[2],componentQuery=componentData[3]?eval("(function(){return "+componentData[3]+"}())"):{},componentOptions=componentData[4]?eval("(function(){return "+componentData[4]+"}())"):{};switch(componentType){case"List":return new Component.List(node,componentName,componentQuery,componentOptions,parent);case"Table":return new Component.Table(node,componentName,componentQuery,componentOptions,parent);case"Editor":return new Component.Editor(node,componentName,componentQuery,componentOptions,parent);default:throw'Component with type "'+componentType+'" not found'}}function initializeComponents(e,t){$("["+Utils.ATTR_HANDLER+"]",e).each(function(){var e=$(this);if(1!=e.data("creonit-component-initialized")){var n=createComponent(e,t);e.data("creonit-component-initialized",!0),e.data("creonit-component",n)}})}function raw(e){var t=new String(e);return t.twig_markup=!0,t}function generateId(){return++increment}Utils.ATTR_HANDLER="js-component";var increment=0;Utils.escape=escape,Utils.createComponent=createComponent,Utils.initializeComponents=initializeComponents,Utils.raw=raw,Utils.generateId=generateId}(Utils=Component.Utils||(Component.Utils={}))}(Component=Admin.Component||(Admin.Component={}))}(Admin=Creonit.Admin||(Creonit.Admin={}))}(Creonit||(Creonit={}));